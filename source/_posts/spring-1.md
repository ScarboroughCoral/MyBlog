---
title: 一个请求的处理过程（一）拦截器
date: 2018-04-01 16:34:44
tags:
- Spring
- Java Web
- Interceptor
categories:
- Spring
- Java Web
---

<blockquote class="blockquote-center">如果你以为用户是白痴，那就只有白痴才用它。</blockquote>

### 前言

最近由于要搞点事情，所以要准备后端框架的快速入门。首先要了解一下总体的架构，看看哪一方面欠缺，考虑所有用例，探究其实现原理，并注重安全防护。我想从一个请求的处理过程来贯穿分析整个后端。

* 还是一个老掉牙的问题，各门课程有各门课程的掉牙。

> 当你打开浏览器并在地址输入栏输入一个URL地址之后，这背后究竟发生了什么？

`计算机网络有计算机网络的说法，服务有服务的说法。` 从今天开始我们就就讲一讲`Java Web Service` 做了什么。

### 一切从拦截器说起

你或许对拦截器这个词很陌生。没错几天前我也很陌生。那我们今天就开始一起学习一下拦截器，Spring里有这玩意。

如果你对Java Web有一定的了解，那你肯定知道`过滤器`这个东西吧。没错，拦截器和过滤器有一定的相似之处。我们先不讨论他们的区别，让我们来了解一下双方。

### 如何使用过滤器

老掉牙了。

* 实现Filter接口
* 实现init，doFilter，destroy方法
* 在DD中注册filter

### 什么场景使用

顾名思义，过滤作用，在处理请求前做一些处理，在做出响应后做些处理。

> 说到这里，不得不提的是AOP，或许你没有听到过这个东西。曰`Aspect Oriented Programming`，面向切面编程。很好理解，平时我们的模块开发都是纵向的，从接受请求、处理请求、添加数据库一个完整的过程。而面向切面编程是横向的，和他对应的是所有模块或者说是一些模块，比如下面的场景。如果不懂的话请自行百度，`(*^__^*) `

* 例如以下场景

麻蛋，前端返回的请求参数乱码。然后二话不说找前端臭骂一顿，却发现不是别人的事，自己的锅。原来是前端用英文好好的，一输入中文字符就会乱码。嗯，解决办法很简单，就是将请求的编码设置一下就行了。然后发现这个东西需要对所有请求都需要做出相应设置。所以每个请求都要配置一下`setCharsetEncoding("utf-8)？`显然可取，这时候过滤器的作用就出来了。你可以在所有请求前对请求进行一次过滤，然后将请求的编码都设置一下，然后就可以了。怎么保证对所有请求都进行处理呢？你可以通过正则表达式来配置`filter-mapping`，应该是这个东西，具体的也忘了。

* 登录验证

这种情况很常用。比如你打开腾讯视频，想看最新的一集《斗破苍穹》，老子有钱是会员，但是老子没登录啊。嗯，系统提示`哦亲～您还没有登陆哟(づ￣3￣)づ╭❤～`，然后跳到登录页面。然后这种特定页面的权限限制也是通过过滤器来配置的，这也是通过正则来配置特定的几个页面。

### 如何使用拦截器

新玩意

* 实现HandleInterceptor接口
* 重写preHandle，postHandle，afterComplete方法
* 注册拦截器（我是用的Spring Boot，使用@configuration注解来配置设置）

```Java
// 注册拦截器
@Configuration
public class MVCConfig extends WebMvcConfigurerAdapter {
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new CommonInterceptor()).addPathPatterns("/**");
    }
}
```

### 区别

现在说说两者有什么区别吧。其实我也不太懂，知道的也是那种人云亦云的东西。

我们知道filter是servlet的api，他过滤的范围是servlet容器。而拦截器是框架的东西，依赖的是框架容器，比如说spring容器。
现在认为可以把他俩看做有相似功能的东西。